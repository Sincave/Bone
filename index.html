<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù„ÙˆØ­Ø© ØªØ­ÙƒÙ… Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª - Elhomssi Parfums</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="stylesheet" href="style.css">
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@300;400;600;700&display=swap" rel="stylesheet">
</head>
<body>


    <main class="container main-container">
        <!-- Ø§Ù„Ù‚Ø³Ù… Ø§Ù„Ø£ÙŠØ³Ø±: Ù†Ù…ÙˆØ°Ø¬ Ø§Ù„Ø¥Ø¶Ø§ÙØ© ÙˆØ§Ù„Ø¨ÙˆÙ† -->
        <div class="left-section">
            <!-- Ù†Ù…ÙˆØ°Ø¬ Ø¥Ø¶Ø§ÙØ© Ù…Ù†ØªØ¬ -->
            <section class="card form-section">
                <h2><i class="fas fa-plus-circle"></i> Ø¥Ø¶Ø§ÙØ© Ø¹Ù…Ù„ÙŠØ© Ø¨ÙŠØ¹ Ø¬Ø¯ÙŠØ¯Ø©</h2>
                <form id="salesForm">
                    <div class="form-group">
                        <label for="productName"><i class="fas fa-tag"></i> Ø§Ø³Ù… Ø§Ù„Ø¹Ø·Ø±</label>
                        <input type="text" id="productName" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ø³Ù… Ø§Ù„Ø¹Ø·Ø±..." required>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="productPrice"><i class="fas fa-money-bill-wave"></i> Ø§Ù„Ø«Ù…Ù† (Ø¯Ø±Ù‡Ù…)</label>
                            <input type="number" id="productPrice" min="1" placeholder="Ø§Ù„Ø³Ø¹Ø±" required>
                        </div>
                        <div class="form-group">
                            <label for="productQuantity"><i class="fas fa-boxes"></i> Ø§Ù„ÙƒÙ…ÙŠØ©</label>
                            <input type="number" id="productQuantity" min="1" value="1" required>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="deliveryPrice"><i class="fas fa-shipping-fast"></i> Ø«Ù…Ù† Ø§Ù„ØªÙˆØµÙŠÙ„ (Ø¯Ø±Ù‡Ù…)</label>
                        <input type="number" id="deliveryPrice" min="0" value="30" required>
                    </div>
                    
                    <div class="form-total">
                        <p>Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹: <span id="previewTotal">0</span> Ø¯Ø±Ù‡Ù…</p>
                    </div>
                    
                    <button type="submit" class="btn-submit">
                        <i class="fas fa-cart-plus"></i> Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ù†ØªØ¬ ÙˆØ¹Ø±Ø¶ Ø§Ù„Ø¨ÙˆÙ†
                    </button>
                </form>
            </section>

            <!-- Ø§Ù„Ø¨ÙˆÙ† (Ø§Ù„Ø¥ÙŠØµØ§Ù„) -->
            <section class="card receipt-section" id="receiptSection" style="display: none;">
                <h2><i class="fas fa-receipt"></i> Ø¨ÙˆÙ† Ø§Ù„Ø´Ø±Ø§Ø¡</h2>
                <div class="receipt" id="receipt">
                    <!-- Ø³ÙŠØªÙ… Ù…Ù„Ø¤Ù‡ Ø¨Ø§Ù„Ø¬Ø§ÙØ§Ø³ÙƒØ±ÙŠØ¨Øª -->
                </div>
                <div class="receipt-actions">
                    <button id="printReceipt" class="btn-print">
                        <i class="fas fa-print"></i> Ø·Ø¨Ø§Ø¹Ø© Ø§Ù„Ø¨ÙˆÙ†
                    </button>
                    <button id="closeReceipt" class="btn-close">
                        <i class="fas fa-times"></i> Ø¥ØºÙ„Ø§Ù‚
                    </button>
                </div>
            </section>
        </div>

        <!-- Ø§Ù„Ù‚Ø³Ù… Ø§Ù„Ø£ÙŠÙ…Ù†: Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª ÙˆØ§Ù„Ø±Ø³Ù… Ø§Ù„Ø¨ÙŠØ§Ù†ÙŠ -->
        <div class="right-section">
            <!-- Ø£ÙƒØ«Ø± Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ù…Ø¨ÙŠØ¹Ø§Ù‹ -->
            <section class="card best-sellers">
                <h2><i class="fas fa-trophy"></i> Ø£ÙƒØ«Ø± Ø§Ù„Ø¹Ø·ÙˆØ± Ù…Ø¨ÙŠØ¹Ø§Ù‹</h2>
                <div class="table-container">
                    <table id="bestSellersTable">
                        <thead>
                            <tr>
                                <th>#</th>
                                <th>Ø§Ø³Ù… Ø§Ù„Ø¹Ø·Ø±</th>
                                <th>Ø§Ù„ÙƒÙ…ÙŠØ©</th>
                                <th>Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ</th>
                            </tr>
                        </thead>
                        <tbody id="bestSellersBody">
                            <!-- Ø³ÙŠØªÙ… Ù…Ù„Ø¤Ù‡ Ø¨Ø§Ù„Ø¬Ø§ÙØ§Ø³ÙƒØ±ÙŠØ¨Øª -->
                        </tbody>
                    </table>
                </div>
            </section>

            <!-- Ø§Ù„Ø±Ø³Ù… Ø§Ù„Ø¨ÙŠØ§Ù†ÙŠ ÙˆØ§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª Ø§Ù„Ø´Ù‡Ø±ÙŠØ© -->
            <section class="card chart-section">
                <h2><i class="fas fa-chart-bar"></i> Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª Ø§Ù„Ø´Ù‡Ø±ÙŠØ©</h2>
                <div class="chart-container">
                    <canvas id="salesChart"></canvas>
                </div>
                <div class="monthly-totals">
                    <h3><i class="fas fa-calendar-alt"></i> Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª Ù„ÙƒÙ„ Ø´Ù‡Ø±</h3>
                    <ul id="monthlyTotalsList">
                        <!-- Ø³ÙŠØªÙ… Ù…Ù„Ø¤Ù‡ Ø¨Ø§Ù„Ø¬Ø§ÙØ§Ø³ÙƒØ±ÙŠØ¨Øª -->
                    </ul>
                </div>
            </section>
        </div>
    </main>

    <!-- Ù†Ø§ÙØ°Ø© Ù…Ù„Ø®Øµ Ø§Ù„Ø´Ù‡Ø± -->
    <div id="monthModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2><i class="fas fa-file-invoice-dollar"></i> Ù…Ù„Ø®Øµ Ø§Ù„Ø´Ù‡Ø±</h2>
                <span class="close-modal">&times;</span>
            </div>
            <div class="modal-body" id="modalBody">
                <!-- Ø³ÙŠØªÙ… Ù…Ù„Ø¤Ù‡ Ø¨Ø§Ù„Ø¬Ø§ÙØ§Ø³ÙƒØ±ÙŠØ¨Øª -->
            </div>
            <div class="modal-footer">
                <button id="printMonthSummary" class="btn-print">
                    <i class="fas fa-print"></i> Ø·Ø¨Ø§Ø¹Ø© Ø§Ù„Ù…Ù„Ø®Øµ
                </button>
            </div>
        </div>
    </div>



    <script src="script.js"></script>
</body>
</html>




<style>
    /* Reset ÙˆØ¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø£Ø³Ø§Ø³ÙŠØ© */
* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
}




:root {
    --primary-color: #2c3e50;
    --secondary-color: #3498db;
    --accent-color: #e74c3c;
    --light-color: #ecf0f1;
    --dark-color: #2c3e50;
    --success-color: #27ae60;
    --warning-color: #f39c12;
    --border-color: #ddd;
    --shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
    --transition: all 0.3s ease;
}

body {
    font-family: 'Cairo', sans-serif;
    background: black;
    color: #333;
    line-height: 1.6;
    min-height: 100vh;
    padding-top: 80px;
    direction: rtl;
    min-width: 100%;
}

.container {
    width: 100%;
    max-width: 1400px;
    margin: 0 auto;
    padding: 0 20px;
}

/* Ø§Ù„Ù‡ÙŠØ¯Ø± Ø§Ù„Ø«Ø§Ø¨Øª */
.header {
    background: black;
    color: white;
    padding: 15px 0;
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    z-index: 1000;
    box-shadow: var(--shadow);
}

.header .container {
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.logo h1 {
    font-size: 1.5rem;
    margin-bottom: 5px;
    display: flex;
    align-items: center;
    gap: 10px;
}

.logo p {
    font-size: 0.9rem;
    opacity: 0.9;
}

.manager-info {
    display: flex;
    align-items: center;
    gap: 15px;
}

.manager-img {
    width: 70px;
    height: 70px;
    border-radius: 50%;
    overflow: hidden;
    border: 2px solid white;
    transition: var(--transition);
}

.manager-img:hover {
    transform: scale(1.05);
    border-color: var(--accent-color);
}

.manager-img img {
    width: 100%;
    height: 100%;
    object-fit: cover;
}

.manager-name {
    font-weight: 600;
    font-size: 0.9rem;
}

/* Ø§Ù„ØªØµÙ…ÙŠÙ… Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ */
.main-container {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 30px;
    padding: 30px 20px;
}

.card {
    background: white;
    border-radius: 15px;
    padding: 25px;
    margin-bottom: 25px;
    box-shadow: var(--shadow);
    transition: var(--transition);
    border: 1px solid var(--border-color);
}

.card:hover {
    transform: translateY(-5px);
    box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
}

.card h2 {
    color: black;
    margin-bottom: 20px;
    padding-bottom: 15px;
    border-bottom: 2px dashed var(--border-color);
    display: flex;
    align-items: center;
    gap: 10px;
    font-size: 1.3rem;
}

/* Ù†Ù…ÙˆØ°Ø¬ Ø§Ù„Ø¥Ø¶Ø§ÙØ© */
.form-section {
    background: linear-gradient(135deg, #ffffff 0%, #f8f9fa 100%);
}

.form-group {
    margin-bottom: 20px;
}

.form-group label {
    display: block;
    margin-bottom: 8px;
    font-weight: 600;
    color: black;
    display: flex;
    align-items: center;
    gap: 8px;
}

.form-group input {
    width: 100%;
    padding: 12px 15px;
    border: 2px solid var(--border-color);
    border-radius: 10px;
    font-size: 1rem;
    transition: var(--transition);
    font-family: 'Cairo', sans-serif;
}

.form-group input:focus {
    outline: none;
    border-color: var(--secondary-color);
    box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.2);
}

.form-row {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 20px;
}

.form-total {
    background: #f8f9fa;
    padding: 15px;
    border-radius: 10px;
    margin: 20px 0;
    text-align: center;
    border: 2px dashed var(--border-color);
}

.form-total p {
    font-size: 1.2rem;
    font-weight: 700;
    color: var(--success-color);
}

.btn-submit {
    width: 100%;
    padding: 15px;
    background: black;
    color: white;
    border: none;
    border-radius: 10px;
    font-size: 1.1rem;
    font-weight: 600;
    cursor: pointer;
    transition: var(--transition);
    display: flex;
    justify-content: center;
    align-items: center;
    gap: 10px;
    font-family: 'Cairo', sans-serif;
}

.btn-submit:hover {
    background: linear-gradient(135deg, #2980b9 0%, var(--secondary-color) 100%);
    transform: translateY(-2px);
}

/* Ø§Ù„Ø¨ÙˆÙ† (Ø§Ù„Ø¥ÙŠØµØ§Ù„) */
.receipt {
    background: white;
  
    border-radius: 10px;
    padding: 25px;
    font-family: 'Courier New', monospace;
    position: relative;
    overflow: hidden;
}

.receipt::before {
    content: "";
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    height: 5px;
    background: black;
}

.receipt-header {
    text-align: center;
    margin-bottom: 25px;
    padding-bottom: 15px;
    
}


.receipt-logo-img {
    width: 60px;        /* Ø­Ø¬Ù… Ø§Ù„Ø¯Ø§Ø¦Ø±Ø© */
    height: 60px;
    border-radius: 50%;
    overflow: hidden;
    display: flex;
    align-items: center;
    justify-content: center;
}

.receipt-logo-img img {
    width: 100%;
    height: 100%;
    object-fit: cover; /* Ø¨Ø§Ø´ Ø§Ù„ØµÙˆØ±Ø© ØªØ¹Ù…Ù‘Ø± Ø§Ù„Ø¯Ø§Ø¦Ø±Ø© Ù…Ø²ÙŠØ§Ù† */
}

.receipt-logo {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 15px;
    margin-bottom: 15px;
}

.receipt-logo-img {
    width: 70px;
    height: 70px;
    background: linear-gradient(135deg, #d4af37, #ffd700);
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 1.8rem;
    color: white;
    font-weight: bold;
}

.receipt-logo-text {
    font-size: 1.8rem;
    color: var(--primary-color);
    font-weight: bold;
}

.receipt-details {
    margin: 20px 0;
}

.receipt-item {
    display: flex;
    justify-content: space-between;
    padding: 12px 0;
    
    position: relative;
}

.receipt-item:last-child {
    border-bottom: 2px solid #000;
}

.receipt-item.total {
    font-size: 1.2rem;
    font-weight: bold;
    color: black;
}

.receipt-footer {
    text-align: center;
    margin-top: 25px;
    padding-top: 15px;
    border-top: 2px dashed #ccc;
    color: #666;
    font-size: 0.9rem;
}

.receipt-thankyou {
    margin-top: 20px;
    padding: 15px;
    background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
    border-radius: 8px;
    text-align: center;
    font-style: italic;
    color: var(--primary-color);
    font-weight: 600;
}

.receipt-actions {
    display: flex;
    gap: 15px;
    margin-top: 20px;
}

.btn-print, .btn-close {
    flex: 1;
    padding: 12px;
    border: none;
    border-radius: 8px;
    font-size: 1rem;
    font-weight: 600;
    cursor: pointer;
    transition: var(--transition);
    display: flex;
    justify-content: center;
    align-items: center;
    gap: 8px;
    font-family: 'Cairo', sans-serif;
}

.btn-print {
    background: linear-gradient(135deg, #27ae60 0%, #219653 100%);
    color: white;
}

.btn-close {
    background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%);
    color: white;
}

.btn-print:hover, .btn-close:hover {
    transform: translateY(-2px);
    opacity: 0.9;
}

/* Ø¬Ø¯ÙˆÙ„ Ø£ÙƒØ«Ø± Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ù…Ø¨ÙŠØ¹Ø§Ù‹ */
.table-container {
    overflow-x: auto;
}

#bestSellersTable {
    width: 100%;
    border-collapse: collapse;
    margin-top: 15px;
}

#bestSellersTable thead {
    background: black;
    color: white;
}

#bestSellersTable th {
    padding: 15px;
    text-align: center;
    font-weight: 600;
}

#bestSellersTable td {
    padding: 15px;
    text-align: center;
    border-bottom: 1px solid var(--border-color);
}

#bestSellersTable tbody tr:hover {
    background-color: #f8f9fa;
    transform: scale(1.01);
    transition: var(--transition);
}

#bestSellersTable tbody tr:nth-child(1) {
    background: linear-gradient(135deg, #fff8e1 0%, #ffecb3 100%);
    font-weight: bold;
}

/* Ø§Ù„Ø±Ø³Ù… Ø§Ù„Ø¨ÙŠØ§Ù†ÙŠ */
.chart-container {
    position: relative;
    height: 300px;
    margin: 20px 0;
}

.monthly-totals {
    margin-top: 25px;
}

.monthly-totals h3 {
    color: var(--primary-color);
    margin-bottom: 15px;
    display: flex;
    align-items: center;
    gap: 10px;
    font-size: 1.1rem;
}

#monthlyTotalsList {
    list-style: none;
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
    gap: 12px;
}

#monthlyTotalsList li {
    background: #f8f9fa;
    padding: 15px;
    border-radius: 10px;
    border-left: 4px solid black;
    cursor: pointer;
    transition: var(--transition);
    display: flex;
    justify-content: space-between;
    align-items: center;
}

#monthlyTotalsList li:hover {
    background: #e3f2fd;
    transform: translateX(-5px);
}

#monthlyTotalsList li .month-total {
    font-weight: bold;
    color: var(--success-color);
}

/* Ø§Ù„Ù†Ø§ÙØ°Ø© Ø§Ù„Ù…Ù†Ø¨Ø«Ù‚Ø© */
.modal {
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.7);
    z-index: 2000;
    animation: fadeIn 0.3s ease;
}

@keyframes fadeIn {
    from { opacity: 0; }
    to { opacity: 1; }
}

.modal-content {
    background: white;
    margin: 5% auto;
    width: 90%;
    max-width: 700px;
    border-radius: 15px;
    overflow: hidden;
    animation: slideIn 0.3s ease;
}

@keyframes slideIn {
    from { transform: translateY(-50px); opacity: 0; }
    to { transform: translateY(0); opacity: 1; }
}

.modal-header {
    background: black;
    color: white;
    padding: 20px;
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.modal-header h2 {
    margin: 0;
    display: flex;
    align-items: center;
    gap: 10px;
}

.close-modal {
    font-size: 2rem;
    cursor: pointer;
    transition: var(--transition);
}

.close-modal:hover {
    color: var(--accent-color);
}

.modal-body {
    padding: 30px;
    max-height: 60vh;
    overflow-y: auto;
}

.modal-footer {
    padding: 20px;
    background: #f8f9fa;
    text-align: center;
    border-top: 1px solid var(--border-color);
}

/* ØªØµÙ…ÙŠÙ… Ù…ØªØ¬Ø§ÙˆØ¨ */
@media (max-width: 1200px) {
    .main-container {
        grid-template-columns: 1fr;
    }
    
    .left-section, .right-section {
        width: 100%;
    }
}

@media (max-width: 768px) {
    body {
        padding-top: 120px;
    }
    
    .header .container {
        flex-direction: column;
        gap: 15px;
        text-align: center;
    }
    
    .manager-info {
        flex-direction: column;
        text-align: center;
    }
    
    .form-row {
        grid-template-columns: 1fr;
    }
    
    .receipt-actions {
        flex-direction: column;
    }
    
    .chart-container {
        height: 250px;
    }
    
    #monthlyTotalsList {
        grid-template-columns: 1fr;
    }
    
    .modal-content {
        margin: 10% auto;
        width: 95%;
    }
}

.receipt-logo-img {
    width: 70px;        /* Ø­Ø¬Ù… Ø§Ù„Ø¯Ø§Ø¦Ø±Ø© */
    height: 70px;
    border-radius: 50%;
    overflow: hidden;
    display: flex;
    align-items: center;
    justify-content: center;
}

.receipt-logo-img img {
    width: 100%;
    height: 100%;
    object-fit: cover; /* Ø¨Ø§Ø´ Ø§Ù„ØµÙˆØ±Ø© ØªØ¹Ù…Ù‘Ø± Ø§Ù„Ø¯Ø§Ø¦Ø±Ø© Ù…Ø²ÙŠØ§Ù† */
}

@media (max-width: 480px) {
    .card {
        padding: 15px;
    }
    
    .receipt {
        padding: 15px;
    }
    
    .receipt-logo {
        flex-direction: column;
    }
    
    #bestSellersTable th,
    #bestSellersTable td {
        padding: 10px 5px;
        font-size: 0.9rem;
    }
}

@media print {
    body * {
        visibility: hidden;
    }
    
    .receipt, .modal-content,
    .receipt *, .modal-content * {
        visibility: visible;
    }
    
    .receipt, .modal-content {
        position: absolute;
        left: 0;
        top: 0;
        width: 100%;
        box-shadow: none;
        border: none;
    }
    
    .receipt-actions,
    .modal-footer,
    .modal-header .close-modal {
        display: none !important;
    }
}
</style>


<script>

// Ù…ØªØºÙŠØ±Ø§Øª Ø¹Ø§Ù…Ø©
let sales = JSON.parse(localStorage.getItem('sales')) || [];
let chart = null;
const months = [
    'ÙŠÙ†Ø§ÙŠØ±', 'ÙØ¨Ø±Ø§ÙŠØ±', 'Ù…Ø§Ø±Ø³', 'Ø£Ø¨Ø±ÙŠÙ„', 'Ù…Ø§ÙŠÙˆ', 'ÙŠÙˆÙ†ÙŠÙˆ',
    'ÙŠÙˆÙ„ÙŠÙˆ', 'Ø£ØºØ³Ø·Ø³', 'Ø³Ø¨ØªÙ…Ø¨Ø±', 'Ø£ÙƒØªÙˆØ¨Ø±', 'Ù†ÙˆÙÙ…Ø¨Ø±', 'Ø¯ÙŠØ³Ù…Ø¨Ø±'
];

// ØªÙ‡ÙŠØ¦Ø© Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ø¹Ù†Ø¯ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø©
document.addEventListener('DOMContentLoaded', function() {
    initApp();
    
    // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹ Ø¹Ù†Ø¯ ØªØºÙŠÙŠØ± Ø§Ù„Ù‚ÙŠÙ…
    document.getElementById('productPrice').addEventListener('input', updateTotal);
    document.getElementById('productQuantity').addEventListener('input', updateTotal);
    document.getElementById('deliveryPrice').addEventListener('input', updateTotal);
    
    // Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ù†Ù…ÙˆØ°Ø¬
    document.getElementById('salesForm').addEventListener('submit', addSale);
    
    // Ø£Ø­Ø¯Ø§Ø« Ø§Ù„Ø£Ø²Ø±Ø§Ø±
    document.getElementById('printReceipt').addEventListener('click', printReceipt);
    document.getElementById('closeReceipt').addEventListener('click', closeReceipt);
    document.querySelector('.close-modal').addEventListener('click', closeModal);
    document.getElementById('printMonthSummary').addEventListener('click', printMonthSummary);
    
    // Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„Ù†Ø§ÙØ°Ø© Ø§Ù„Ù…Ù†Ø¨Ø«Ù‚Ø© Ø¹Ù†Ø¯ Ø§Ù„Ù†Ù‚Ø± Ø®Ø§Ø±Ø¬Ù‡Ø§
    window.addEventListener('click', function(event) {
        const modal = document.getElementById('monthModal');
        if (event.target === modal) {
            closeModal();
        }
    });
    
    // ØªØ­Ø¯ÙŠØ« Ø£ÙˆÙ„ÙŠ Ù„Ù„Ù…Ø¬Ù…ÙˆØ¹
    updateTotal();
});

// ØªÙ‡ÙŠØ¦Ø© Ø§Ù„ØªØ·Ø¨ÙŠÙ‚
function initApp() {
    renderBestSellers();
    renderMonthlyTotals();
    initChart();
}

// ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹ Ø§Ù„Ù…Ø³Ø¨Ù‚
function updateTotal() {
    const price = parseFloat(document.getElementById('productPrice').value) || 0;
    const quantity = parseInt(document.getElementById('productQuantity').value) || 0;
    const delivery = parseFloat(document.getElementById('deliveryPrice').value) || 0;
    const total = (price * quantity) + delivery;
    
    document.getElementById('previewTotal').textContent = total.toFixed(2);
}

// Ø¥Ø¶Ø§ÙØ© Ø¹Ù…Ù„ÙŠØ© Ø¨ÙŠØ¹ Ø¬Ø¯ÙŠØ¯Ø©
function addSale(e) {
    e.preventDefault();
    
    const productName = document.getElementById('productName').value.trim();
    const price = parseFloat(document.getElementById('productPrice').value);
    const quantity = parseInt(document.getElementById('productQuantity').value);
    const delivery = parseFloat(document.getElementById('deliveryPrice').value);
    
    if (!productName || price <= 0 || quantity <= 0) {
        alert('ÙŠØ±Ø¬Ù‰ Ù…Ù„Ø¡ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø¨Ø´ÙƒÙ„ ØµØ­ÙŠØ­');
        return;
    }
    
    const sale = {
        id: Date.now(),
        productName: productName,
        price: price,
        quantity: quantity,
        delivery: delivery,
        total: (price * quantity) + delivery,
        date: new Date().toISOString().split('T')[0],
        timestamp: Date.now()
    };
    
    sales.push(sale);
    localStorage.setItem('sales', JSON.stringify(sales));
    
    // Ø¹Ø±Ø¶ Ø§Ù„Ø¨ÙˆÙ†
    showReceipt(sale);
    
    // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
    renderBestSellers();
    renderMonthlyTotals();
    updateChart();
    
    // Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ù†Ù…ÙˆØ°Ø¬
    document.getElementById('salesForm').reset();
    document.getElementById('deliveryPrice').value = 30;
    updateTotal();
}

// Ø¹Ø±Ø¶ Ø§Ù„Ø¨ÙˆÙ†
function showReceipt(sale) {
    const receiptHTML = `
        <div class="receipt-header">
            <div class="receipt-logo">
                <div class="receipt-logo-img">
    <img src="Logo22.jpg" alt="Logo">
</div>
                
                <div class="receipt-logo-text">Elhomssi Parfums</div>
            </div>
            <p>ÙØ§ØªÙˆØ±Ø© Ø±Ù‚Ù…: ${sale.id}</p>
            <p>Ø§Ù„ØªØ§Ø±ÙŠØ®: ${formatDate(sale.date)}</p>
            <div style="border-bottom: 2px dashed #ccc; margin: 15px 0;"></div>
        </div>
        
        <div class="receipt-details">
            <div class="receipt-item">
                <span>Ø§Ø³Ù… Ø§Ù„Ø¹Ø·Ø±:</span>
                <span>${sale.productName}</span>
            </div>
            <div class="receipt-item">
                <span>Ø«Ù…Ù† Ø§Ù„ÙˆØ­Ø¯Ø©:</span>
                <span>${sale.price.toFixed(2)} Ø¯Ø±Ù‡Ù…</span>
            </div>
            <div class="receipt-item">
                <span>Ø§Ù„ÙƒÙ…ÙŠØ©:</span>
                <span>${sale.quantity}</span>
            </div>
            <div class="receipt-item">
                <span>Ø«Ù…Ù† Ø§Ù„ØªÙˆØµÙŠÙ„:</span>
                <span>${sale.delivery.toFixed(2)} Ø¯Ø±Ù‡Ù…</span>
            </div>
            <div class="receipt-item" style="color: #27ae60; font-weight: bold;">
                <span>Ø«Ù…Ù† Ø§Ù„Ù…Ù†ØªØ¬ ÙÙ‚Ø·:</span>
                <span>${(sale.price * sale.quantity).toFixed(2)} Ø¯Ø±Ù‡Ù…</span>
            </div>
            <div class="receipt-item total">
                <span>Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ:</span>
                <span>${sale.total.toFixed(2)} Ø¯Ø±Ù‡Ù…</span>
            </div>
        </div>
        
        <div style="border-bottom: 2px dashed #ccc; margin: 20px 0;"></div>
        
        <div class="receipt-footer">
            <p><strong>Ø§Ù„ØªÙˆØµÙŠÙ„ Ø£Ù‚Ù„ Ù…Ù† 24 Ø³Ø§Ø¹Ø©ØŒ Ø³ØªØ­ØµÙ„ Ø¹Ù„Ù‰ Ø·Ù„Ø¨Ùƒ Ù‚Ø±ÙŠØ¨Ø§Ù‹</strong></p>
            <p style="margin-top: 10px; color: #666; font-size: 0.85rem;">
                Ø´ÙƒØ±Ø§Ù‹ Ù„Ø²ÙŠØ§Ø±ØªÙƒÙ…ØŒ Ù†ØªÙ…Ù†Ù‰ Ù„ÙƒÙ… ØªØ¬Ø±Ø¨Ø© Ø±Ø§Ø¦Ø¹Ø© Ù…Ø¹ Ø¹Ø·ÙˆØ±Ù†Ø§
            </p>
        </div>
        
        <div class="receipt-thankyou">
            <p>Ø´ÙƒØ±Ø§ Ù„Ø«Ù‚ØªÙƒÙ… ÙÙŠ Elhomssi Parfums</p>
            <p style="font-size: 0.8rem; margin-top: 5px;">Ù„Ù„Ø§Ø³ØªÙØ³Ø§Ø±: 0612345678</p>
        </div>
    `;
    
    document.getElementById('receipt').innerHTML = receiptHTML;
    document.getElementById('receiptSection').style.display = 'block';
    
    // ØªÙ…Ø±ÙŠØ± Ù„Ù„Ø¨ÙˆÙ†
    document.getElementById('receiptSection').scrollIntoView({ behavior: 'smooth' });
}

// Ø·Ø¨Ø§Ø¹Ø© Ø§Ù„Ø¨ÙˆÙ† - ØªÙ… Ø§Ù„ØªØµØ­ÙŠØ­
function printReceipt() {
    const receiptContent = document.getElementById('receipt').innerHTML;
    const printWindow = window.open('', '_blank', 'width=800,height=600');
    
    if (!printWindow) {
        alert('ÙŠØ±Ø¬Ù‰ Ø§Ù„Ø³Ù…Ø§Ø­ Ø¨Ø§Ù„Ù†ÙˆØ§ÙØ° Ø§Ù„Ù…Ù†Ø¨Ø«Ù‚Ø© Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø®Ø§ØµÙŠØ© Ø§Ù„Ø·Ø¨Ø§Ø¹Ø©');
        return;
    }
    
    printWindow.document.open();
    printWindow.document.write(`
        <!DOCTYPE html>
        <html dir="rtl" lang="ar">
        <head>
            <meta charset="UTF-8">
            <title>Ø·Ø¨Ø§Ø¹Ø© ÙØ§ØªÙˆØ±Ø© Elhomssi Parfums</title>
            <link rel="preconnect" href="https://fonts.googleapis.com">
            <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
            <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;500;600;700&display=swap" rel="stylesheet">
            <style>
                * {
                    margin: 0;
                    padding: 0;
                    box-sizing: border-box;
                }
                
                body {
                    font-family: 'Cairo', sans-serif;
                    padding: 30px;
                    background: #fff;
                    color: #000;
                    direction: rtl;
                    text-align: right;
                    max-width: 500px;
                    margin: 0 auto;
                }
                
                .receipt-content {
                    
                    padding: 25px;
                    position: relative;
                    background: white;
                }
                
                .receipt-logo {
                    text-align: center;
                    margin-bottom: 20px;
                    padding-bottom: 15px;
                    border-bottom: 2px dashed #2c3e50;
                }
                
                .receipt-logo-img {
                    width: 80px;
                    height: 80px;
                    background: linear-gradient(135deg, #2c3e50 0%, #3498db 100%);
                    color: white;
                    border-radius: 50%;
                    display: flex;
                    align-items: center;
                    justify-content: center;
                    font-size: 28px;
                    font-weight: bold;
                    margin: 0 auto 10px;
                }
                
                .receipt-logo-text {
                    font-size: 22px;
                    font-weight: bold;
                    color: #2c3e50;
                    letter-spacing: -0.5px;
                }
                
                .receipt-header p {
                    text-align: center;
                    margin: 8px 0;
                    color: #555;
                }
                
                .receipt-details {
                    margin: 25px 0;
                }
                
                .receipt-item {
                    display: flex;
                    justify-content: space-between;
                    margin: 12px 0;
                    padding-bottom: 8px;
                    border-bottom: 1px dotted #ddd;
                }
                
                .receipt-item.total {
                    font-size: 1.3em;
                    font-weight: bold;
                    color: #27ae60;
                    margin-top: 20px;
                    padding-top: 15px;
                    border-top: 2px solid #27ae60;
                    border-bottom: none;
                }
                
                .receipt-footer {
                    text-align: center;
                    margin-top: 30px;
                    padding-top: 20px;
                    border-top: 2px dashed #2c3e50;
                }
                
                .receipt-footer p {
                    margin: 10px 0;
                    color: #555;
                }
                
                .receipt-thankyou {
                    text-align: center;
                    margin-top: 25px;
                    padding: 15px;
                    background: #f8f9fa;
                    border-radius: 10px;
                    border: 1px solid #ddd;
                }
                
                @media print {
                    body {
                        padding: 15px;
                        margin: 0;
                    }
                    
                    .receipt-content {
                        border: 2px solid #000;
                        padding: 20px;
                        box-shadow: none;
                    }
                    
                    .no-print {
                        display: none !important;
                    }
                }
                
                @page {
                    size: auto;
                    margin: 15mm;
                }
                
                .print-info {
                    text-align: center;
                    font-size: 12px;
                    color: #666;
                    margin-top: 20px;
                    padding-top: 10px;
                    border-top: 1px solid #ddd;
                }
            </style>
        </head>
        <body>
            <div class="receipt-content">
                ${receiptContent}
                <div class="print-info">
                    <p>ØªÙ…Øª Ø§Ù„Ø·Ø¨Ø§Ø¹Ø© ÙÙŠ: ${formatDate(new Date().toISOString().split('T')[0])} - ${new Date().toLocaleTimeString('ar-EG')}</p>
                    <p>Elhomssi Parfums Â© ${new Date().getFullYear()}</p>
                </div>
            </div>
            <script>
                window.onload = function() {
                    // Ù…Ø­Ø§ÙˆÙ„Ø© Ø§Ù„Ø·Ø¨Ø§Ø¹Ø© Ø¨Ø¹Ø¯ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø©
                    setTimeout(function() {
                        window.print();
                        // Ù„Ø§ Ù†ØºÙ„Ù‚ Ø§Ù„Ù†Ø§ÙØ°Ø© ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ Ø¨Ù„ Ù†ØªØ±Ùƒ Ù„Ù„Ù…Ø³ØªØ®Ø¯Ù…
                    }, 500);
                };
                
                // Ø¥Ø¶Ø§ÙØ© Ø²Ø± Ù„Ù„Ø¹ÙˆØ¯Ø©
                document.addEventListener('DOMContentLoaded', function() {
                    const backButton = document.createElement('button');
                    backButton.innerHTML = 'Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„ØªØ·Ø¨ÙŠÙ‚';
                    backButton.style.cssText = 'position: fixed; bottom: 20px; left: 20px; background: #2c3e50; color: white; border: none; padding: 10px 20px; border-radius: 5px; cursor: pointer; font-family: Cairo; z-index: 1000;';
                    backButton.onclick = function() {
                        window.close();
                    };
                    document.body.appendChild(backButton);
                    
                    // Ø¥Ø¶Ø§ÙØ© Ø²Ø± Ø§Ù„Ø·Ø¨Ø§Ø¹Ø© Ù…Ø±Ø© Ø£Ø®Ø±Ù‰
                    const printButton = document.createElement('button');
                    printButton.innerHTML = 'ğŸ–¨ï¸ Ø·Ø¨Ø§Ø¹Ø© Ø§Ù„ÙØ§ØªÙˆØ±Ø©';
                    printButton.style.cssText = 'position: fixed; bottom: 20px; right: 20px; background: #27ae60; color: white; border: none; padding: 10px 20px; border-radius: 5px; cursor: pointer; font-family: Cairo; z-index: 1000;';
                    printButton.onclick = function() {
                        window.print();
                    };
                    document.body.appendChild(printButton);
                });
            <\/script>
        </body>
        </html>
    `);
    
    printWindow.document.close();
}

// Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„Ø¨ÙˆÙ†
function closeReceipt() {
    document.getElementById('receiptSection').style.display = 'none';
}

// Ø¹Ø±Ø¶ Ø£ÙƒØ«Ø± Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ù…Ø¨ÙŠØ¹Ø§Ù‹ Ù…Ø¹ Ø¥Ø¶Ø§ÙØ© Ø¹Ù…ÙˆØ¯ Ø§Ù„ØªÙˆØµÙŠÙ„
function renderBestSellers() {
    const products = {};
    
    sales.forEach(sale => {
        if (!products[sale.productName]) {
            products[sale.productName] = {
                quantity: 0,
                total: 0,
                delivery: 0,
                productTotal: 0
            };
        }
        products[sale.productName].quantity += sale.quantity;
        products[sale.productName].total += sale.total;
        products[sale.productName].delivery += sale.delivery;
        products[sale.productName].productTotal += (sale.price * sale.quantity);
    });
    
    const sortedProducts = Object.entries(products)
        .sort((a, b) => b[1].quantity - a[1].quantity)
        .slice(0, 10);
    
    const tbody = document.getElementById('bestSellersBody');
    tbody.innerHTML = '';
    
    sortedProducts.forEach(([productName, data], index) => {
        const row = document.createElement('tr');
        row.innerHTML = `
            <td>${index + 1}</td>
            <td>${productName}</td>
            <td>${data.quantity}</td>
            <td>${data.productTotal.toFixed(2)} Ø¯Ø±Ù‡Ù…</td>
            <td>${data.delivery.toFixed(2)} Ø¯Ø±Ù‡Ù…</td>
            <td>${data.total.toFixed(2)} Ø¯Ø±Ù‡Ù…</td>
        `;
        tbody.appendChild(row);
    });
}

// Ø¹Ø±Ø¶ Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª Ø§Ù„Ø´Ù‡Ø±ÙŠØ©
function renderMonthlyTotals() {
    const monthlyData = getMonthlyData();
    const list = document.getElementById('monthlyTotalsList');
    list.innerHTML = '';
    
    monthlyData.forEach((data, index) => {
        if (data.total > 0) {
            const li = document.createElement('li');
            li.dataset.month = index;
            li.innerHTML = `
                <span>${months[index]}</span>
                <div style="display: flex; flex-direction: column; align-items: flex-end;">
                    <span class="month-total">${data.total.toFixed(2)} Ø¯Ø±Ù‡Ù…</span>
                    <small style="color: #27ae60; font-size: 0.8rem;">(ØªÙˆØµÙŠÙ„: ${data.delivery.toFixed(2)} Ø¯Ø±Ù‡Ù…)</small>
                </div>
            `;
            
            li.addEventListener('click', () => showMonthSummary(index));
            list.appendChild(li);
        }
    });
    
    if (list.children.length === 0) {
        const message = document.createElement('li');
        message.innerHTML = '<span style="text-align: center; color: #666; width: 100%;">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ø¨ÙŠØ¹Ø§Øª Ù…Ø³Ø¬Ù„Ø© Ø¨Ø¹Ø¯</span>';
        list.appendChild(message);
    }
}

// Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª Ø§Ù„Ø´Ù‡Ø±ÙŠØ© Ù…Ø¹ Ø¥Ø¶Ø§ÙØ© Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ØªÙˆØµÙŠÙ„
function getMonthlyData() {
    const currentYear = new Date().getFullYear();
    const monthlyData = Array(12).fill().map(() => ({ 
        total: 0, 
        delivery: 0,
        productSales: 0,
        products: {} 
    }));
    
    sales.forEach(sale => {
        const saleDate = new Date(sale.timestamp || sale.date);
        if (saleDate.getFullYear() === currentYear) {
            const month = saleDate.getMonth();
            monthlyData[month].total += sale.total;
            monthlyData[month].delivery += sale.delivery;
            monthlyData[month].productSales += (sale.price * sale.quantity);
            
            if (!monthlyData[month].products[sale.productName]) {
                monthlyData[month].products[sale.productName] = 0;
            }
            monthlyData[month].products[sale.productName] += sale.quantity;
        }
    });
    
    return monthlyData;
}

// ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ø±Ø³Ù… Ø§Ù„Ø¨ÙŠØ§Ù†ÙŠ Ù…Ø¹ Ø¥Ø¶Ø§ÙØ© Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ØªÙˆØµÙŠÙ„
function initChart() {
    const ctx = document.getElementById('salesChart').getContext('2d');
    const monthlyData = getMonthlyData();
    
    chart = new Chart(ctx, {
        type: 'bar',
        data: {
            labels: months,
            datasets: [
                {
                    label: 'Ù…Ø¨ÙŠØ¹Ø§Øª Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª',
                    data: monthlyData.map(data => data.productSales),
                    backgroundColor: 'rgba(41, 128, 185, 0.8)',
                    borderColor: 'rgba(41, 128, 185, 1)',
                    borderWidth: 2,
                    borderRadius: 6,
                    stack: 'stack1'
                },
                {
                    label: 'Ø«Ù…Ù† Ø§Ù„ØªÙˆØµÙŠÙ„',
                    data: monthlyData.map(data => data.delivery),
                    backgroundColor: 'rgba(46, 204, 113, 0.8)',
                    borderColor: 'rgba(46, 204, 113, 1)',
                    borderWidth: 2,
                    borderRadius: 6,
                    stack: 'stack1'
                }
            ]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                legend: {
                    labels: {
                        font: {
                            family: "'Cairo', sans-serif",
                            size: 14
                        },
                        padding: 20
                    }
                },
                tooltip: {
                    callbacks: {
                        label: function(context) {
                            let label = context.dataset.label || '';
                            if (label) {
                                label += ': ';
                            }
                            label += context.parsed.y.toFixed(2) + ' Ø¯Ø±Ù‡Ù…';
                            return label;
                        },
                        footer: function(tooltipItems) {
                            if (tooltipItems.length === 2) {
                                const total = tooltipItems[0].parsed.y + tooltipItems[1].parsed.y;
                                return 'Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹: ' + total.toFixed(2) + ' Ø¯Ø±Ù‡Ù…';
                            }
                        }
                    }
                }
            },
            scales: {
                y: {
                    beginAtZero: true,
                    stacked: true,
                    ticks: {
                        callback: function(value) {
                            return value + ' Ø¯Ø±Ù‡Ù…';
                        },
                        font: {
                            family: "'Cairo', sans-serif"
                        }
                    },
                    grid: {
                        color: 'rgba(0,0,0,0.1)'
                    },
                    title: {
                        display: true,
                        text: 'Ø§Ù„Ù…Ø¨Ù„Øº (Ø¯Ø±Ù‡Ù…)',
                        font: {
                            family: "'Cairo', sans-serif",
                            size: 14,
                            weight: 'bold'
                        }
                    }
                },
                x: {
                    stacked: true,
                    ticks: {
                        font: {
                            family: "'Cairo', sans-serif"
                        }
                    },
                    grid: {
                        color: 'rgba(0,0,0,0.1)'
                    },
                    title: {
                        display: true,
                        text: 'Ø§Ù„Ø´Ù‡Ø±',
                        font: {
                            family: "'Cairo', sans-serif",
                            size: 14,
                            weight: 'bold'
                        }
                    }
                }
            },
            onClick: (e, elements) => {
                if (elements.length > 0) {
                    const monthIndex = elements[0].index;
                    showMonthSummary(monthIndex);
                }
            }
        }
    });
}

// ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø±Ø³Ù… Ø§Ù„Ø¨ÙŠØ§Ù†ÙŠ
function updateChart() {
    if (chart) {
        const monthlyData = getMonthlyData();
        chart.data.datasets[0].data = monthlyData.map(data => data.productSales);
        chart.data.datasets[1].data = monthlyData.map(data => data.delivery);
        chart.update();
    }
}

// Ø¹Ø±Ø¶ Ù…Ù„Ø®Øµ Ø§Ù„Ø´Ù‡Ø± Ù…Ø¹ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ØªÙˆØµÙŠÙ„
function showMonthSummary(monthIndex) {
    const monthlyData = getMonthlyData();
    const monthData = monthlyData[monthIndex];
    
    let bestProduct = '';
    let bestQuantity = 0;
    
    if (monthData.products && Object.keys(monthData.products).length > 0) {
        const productsArray = Object.entries(monthData.products);
        productsArray.sort((a, b) => b[1] - a[1]);
        bestProduct = productsArray[0][0];
        bestQuantity = productsArray[0][1];
    }
    
    const summaryHTML = `
        <div style="text-align: center; margin-bottom: 25px;">
            <h3 style="color: var(--primary-color); margin-bottom: 10px;">
                <i class="fas fa-calendar-check"></i> ${months[monthIndex]}
            </h3>
            <p style="color: #666;">Ù…Ù„Ø®Øµ Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª Ù„Ù„Ø´Ù‡Ø±</p>
            <div style="border-bottom: 2px dashed #ccc; margin: 20px 0;"></div>
        </div>
        
        <div style="background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%); padding: 20px; border-radius: 10px; margin-bottom: 20px; border: 1px solid #dee2e6;">
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                <div style="background: white; padding: 15px; border-radius: 8px; border-right: 4px solid #3498db;">
                    <span style="display: block; color: #666; margin-bottom: 5px; font-size: 0.9rem;">
                        <i class="fas fa-box"></i> Ù…Ø¨ÙŠØ¹Ø§Øª Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª:
                    </span>
                    <span style="font-size: 1.3rem; font-weight: bold; color: #3498db;">
                        ${monthData.productSales.toFixed(2)} Ø¯Ø±Ù‡Ù…
                    </span>
                </div>
                
                <div style="background: white; padding: 15px; border-radius: 8px; border-right: 4px solid #2ecc71;">
                    <span style="display: block; color: #666; margin-bottom: 5px; font-size: 0.9rem;">
                        <i class="fas fa-truck"></i> Ø«Ù…Ù† Ø§Ù„ØªÙˆØµÙŠÙ„:
                    </span>
                    <span style="font-size: 1.3rem; font-weight: bold; color: #2ecc71;">
                        ${monthData.delivery.toFixed(2)} Ø¯Ø±Ù‡Ù…
                    </span>
                </div>
            </div>
            
            <div style="margin-top: 20px; background: white; padding: 20px; border-radius: 8px; border: 2px solid var(--primary-color);">
                <div style="display: flex; justify-content: space-between; align-items: center;">
                    <span style="font-weight: bold; color: var(--primary-color);">
                        <i class="fas fa-chart-line"></i> Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª:
                    </span>
                    <span style="font-size: 1.8rem; font-weight: bold; color: var(--success-color);">
                        ${monthData.total.toFixed(2)} Ø¯Ø±Ù‡Ù…
                    </span>
                </div>
            </div>
            
            ${bestProduct ? `
                <div style="margin-top: 20px; background: #fff8e1; padding: 15px; border-radius: 8px; border-right: 4px solid #ffc107;">
                    <div style="display: flex; justify-content: space-between; align-items: center;">
                        <span style="font-weight: bold; color: #d35400;">
                            <i class="fas fa-crown"></i> Ø£ÙƒØ«Ø± Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ù…Ø¨ÙŠØ¹Ø§Ù‹:
                        </span>
                        <span style="font-weight: bold; color: var(--accent-color);">
                            ${bestProduct}
                        </span>
                    </div>
                    <div style="text-align: center; margin-top: 10px; color: #e67e22; font-weight: bold;">
                        ØªÙ… Ø¨ÙŠØ¹ ${bestQuantity} ÙˆØ­Ø¯Ø©
                    </div>
                </div>
            ` : ''}
        </div>
        
        <div style="margin-top: 20px; background: white; padding: 15px; border-radius: 8px; border: 1px solid #dee2e6;">
            <h4 style="color: var(--primary-color); margin-bottom: 15px; padding-bottom: 10px; border-bottom: 2px solid #f1f1f1;">
                <i class="fas fa-chart-pie"></i> ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ø§Ù„Ù…Ø¨ÙŠØ¹Ø©
            </h4>
            
            ${monthData.products && Object.keys(monthData.products).length > 0 ? `
                <div style="max-height: 200px; overflow-y: auto;">
                    <table style="width: 100%; border-collapse: collapse;">
                        <thead>
                            <tr style="background: linear-gradient(135deg, var(--primary-color) 0%, #1a5276 100%); color: white;">
                                <th style="padding: 12px; text-align: right;">Ø§Ù„Ù…Ù†ØªØ¬</th>
                                <th style="padding: 12px; text-align: center;">Ø§Ù„ÙƒÙ…ÙŠØ©</th>
                                <th style="padding: 12px; text-align: center;">Ø§Ù„Ù†Ø³Ø¨Ø©</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${Object.entries(monthData.products)
                                .sort((a, b) => b[1] - a[1])
                                .map(([product, quantity]) => `
                                    <tr style="border-bottom: 1px solid #eee; transition: background 0.3s;">
                                        <td style="padding: 10px; text-align: right;">${product}</td>
                                        <td style="padding: 10px; text-align: center; font-weight: bold;">${quantity}</td>
                                        <td style="padding: 10px; text-align: center; color: #27ae60;">${((quantity/bestQuantity)*100).toFixed(1)}%</td>
                                    </tr>
                                `).join('')}
                        </tbody>
                    </table>
                </div>
            ` : '<p style="text-align: center; color: #666; padding: 20px;">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ø¨ÙŠØ¹Ø§Øª Ù„Ù‡Ø°Ø§ Ø§Ù„Ø´Ù‡Ø±</p>'}
        </div>
        
        <div style="margin-top: 25px; text-align: center; color: #666; font-size: 0.9rem; padding: 15px; background: #f8f9fa; border-radius: 8px;">
            <p><i class="fas fa-info-circle"></i> Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø´Ù‡Ø± ${months[monthIndex]} - ${new Date().getFullYear()}</p>
            <p style="margin-top: 5px;">Ø¹Ø¯Ø¯ Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª: ${Object.keys(monthData.products).length}</p>
        </div>
    `;
    
    document.getElementById('modalBody').innerHTML = summaryHTML;
    document.getElementById('monthModal').style.display = 'block';
    document.body.style.overflow = 'hidden';
}

// Ø·Ø¨Ø§Ø¹Ø© Ù…Ù„Ø®Øµ Ø§Ù„Ø´Ù‡Ø±
function printMonthSummary() {
    const modalContent = document.getElementById('modalBody').innerHTML;
    const monthIndex = document.querySelector('#modalBody h3')?.textContent?.match(/ÙŠÙ†Ø§ÙŠØ±|ÙØ¨Ø±Ø§ÙŠØ±|Ù…Ø§Ø±Ø³|Ø£Ø¨Ø±ÙŠÙ„|Ù…Ø§ÙŠÙˆ|ÙŠÙˆÙ†ÙŠÙˆ|ÙŠÙˆÙ„ÙŠÙˆ|Ø£ØºØ³Ø·Ø³|Ø³Ø¨ØªÙ…Ø¨Ø±|Ø£ÙƒØªÙˆØ¨Ø±|Ù†ÙˆÙÙ…Ø¨Ø±|Ø¯ÙŠØ³Ù…Ø¨Ø±/)?.[0];
    const monthName = monthIndex ? monthIndex : months[new Date().getMonth()];
    
    const printWindow = window.open('', '_blank', 'width=900,height=700');
    
    if (!printWindow) {
        alert('ÙŠØ±Ø¬Ù‰ Ø§Ù„Ø³Ù…Ø§Ø­ Ø¨Ø§Ù„Ù†ÙˆØ§ÙØ° Ø§Ù„Ù…Ù†Ø¨Ø«Ù‚Ø© Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø®Ø§ØµÙŠØ© Ø§Ù„Ø·Ø¨Ø§Ø¹Ø©');
        return;
    }
    
    printWindow.document.open();
    printWindow.document.write(`
        <!DOCTYPE html>
        <html dir="rtl" lang="ar">
        <head>
            <meta charset="UTF-8">
            <title>Ø·Ø¨Ø§Ø¹Ø© Ù…Ù„Ø®Øµ ${monthName} - Elhomssi Parfums</title>
            <link rel="preconnect" href="https://fonts.googleapis.com">
            <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
            <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;500;600;700&display=swap" rel="stylesheet">
            <style>
                * {
                    margin: 0;
                    padding: 0;
                    box-sizing: border-box;
                }
                
                body {
                    font-family: 'Cairo', sans-serif;
                    padding: 30px;
                    background: #fff;
                    color: #000;
                    direction: rtl;
                    text-align: right;
                    max-width: 800px;
                    margin: 0 auto;
                }
                
                .print-header {
                    text-align: center;
                    margin-bottom: 40px;
                    padding-bottom: 20px;
                    border-bottom: 3px double #2c3e50;
                }
                
                .company-logo {
                    display: flex;
                    align-items: center;
                    justify-content: center;
                    margin-bottom: 20px;
                    gap: 15px;
                }
                
                .logo-img {
                    width: 70px;
                    height: 70px;
                    background: linear-gradient(135deg, #2c3e50 0%, #3498db 100%);
                    color: white;
                    border-radius: 50%;
                    display: flex;
                    align-items: center;
                    justify-content: center;
                    font-size: 24px;
                    font-weight: bold;
                }
                
                .logo-text {
                    font-size: 28px;
                    font-weight: bold;
                    color: #2c3e50;
                }

    .receipt-logo {
                    text-align: center;
                    margin-bottom: 20px;
                    padding-bottom: 15px;
                    border-bottom: 2px dashed #2c3e50;
                }
                
                .receipt-logo-img {
                    width: 80px;
                    height: 80px;
                    background: linear-gradient(135deg, #2c3e50 0%, #3498db 100%);
                    color: white;
                    border-radius: 50%;
                    display: flex;
                    align-items: center;
                    justify-content: center;
                    font-size: 28px;
                    font-weight: bold;
                    margin: 0 auto 10px;
                }
                
                .stats-grid {
                    display: grid;
                    grid-template-columns: repeat(2, 1fr);
                    gap: 20px;
                    margin: 30px 0;
                }
                
                .stat-box {
                    background: #f8f9fa;
                    padding: 20px;
                    border-radius: 10px;
                    border: 1px solid #dee2e6;
                }
                
                .stat-box.total {
                    grid-column: span 2;
                    background: linear-gradient(135deg, #27ae60 0%, #2ecc71 100%);
                    color: white;
                    border: none;
                }
                
                .stat-box.total h3 {
                    color: white;
                }
                
                .stat-label {
                    display: block;
                    color: #666;
                    margin-bottom: 8px;
                    font-size: 0.9rem;
                }
                
                .stat-value {
                    font-size: 1.5rem;
                    font-weight: bold;
                    display: block;
                }
                
                .products-table {
                    width: 100%;
                    border-collapse: collapse;
                    margin: 25px 0;
                    box-shadow: 0 0 10px rgba(0,0,0,0.1);
                }
                
                .products-table th {
                    background: linear-gradient(135deg, #2c3e50 0%, #1a5276 100%);
                    color: white;
                    padding: 15px;
                    text-align: right;
                    border: none;
                }
                
                .products-table td {
                    padding: 12px 15px;
                    border-bottom: 1px solid #ddd;
                    text-align: right;
                }
                
                .products-table tr:hover {
                    background: #f9f9f9;
                }
                
                .footer {
                    text-align: center;
                    margin-top: 40px;
                    padding-top: 20px;
                    border-top: 2px solid #2c3e50;
                    color: #666;
                    font-size: 0.9rem;
                }
                
                @media print {
                    body {
                        padding: 15px;
                        margin: 0;
                    }
                    
                    .no-print {
                        display: none !important;
                    }
                    
                   
                    @page {
                        size: auto;
                        margin: 15mm;
                    }
                }
                
                .print-controls {
                    position: fixed;
                    bottom: 20px;
                    left: 20px;
                    z-index: 1000;
                    display: flex;
                    gap: 10px;
                }
                
                .print-btn {
                    background: #2c3e50;
                    color: white;
                    border: none;
                    padding: 10px 20px;
                    border-radius: 5px;
                    cursor: pointer;
                    font-family: 'Cairo', sans-serif;
                    font-size: 14px;
                }
                
                .print-btn.print {
                    background: #27ae60;
                }
            </style>
        </head>
        <body>
            <div class="print-header">
                <div class="company-logo">
                    <div class="logo-img">EP</div>
                    <div class="logo-text">Elhomssi Parfums</div>
                </div>
                <h1>Ù…Ù„Ø®Øµ Ù…Ø¨ÙŠØ¹Ø§Øª Ø´Ù‡Ø± ${monthName}</h1>
                <p>Ø§Ù„ØªØ§Ø±ÙŠØ®: ${formatDate(new Date().toISOString().split('T')[0])}</p>
                <p>ØªÙ… Ø§Ù„Ø¥Ù†Ø´Ø§Ø¡ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ Ø¨ÙˆØ§Ø³Ø·Ø© Ù†Ø¸Ø§Ù… Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª</p>
            </div>
            
            ${modalContent}
            
            <div class="footer">
                <p>Elhomssi Parfums Â© ${new Date().getFullYear()}</p>
                <p>Ù„Ù„Ø§Ø³ØªÙØ³Ø§Ø±: 0612345678 | Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ: info@elhomssi.ma</p>
                <p style="margin-top: 10px; font-size: 0.8rem; color: #999;">
                    Ù‡Ø°Ø§ Ø§Ù„Ù…Ø³ØªÙ†Ø¯ ØªÙ… Ø¥Ù†Ø´Ø§Ø¤Ù‡ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ ÙˆÙ„Ø§ ÙŠØ­ØªØ§Ø¬ Ø¥Ù„Ù‰ ØªÙˆÙ‚ÙŠØ¹
                </p>
            </div>
            
            <div class="print-controls no-print">
                <button class="print-btn print" onclick="window.print()">ğŸ–¨ï¸ Ø·Ø¨Ø§Ø¹Ø© Ø§Ù„Ù…Ø³ØªÙ†Ø¯</button>
                <button class="print-btn" onclick="window.close()">Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„ØªØ·Ø¨ÙŠÙ‚</button>
            </div>
            
            <script>
                window.onload = function() {
                    // Ø¥Ø¶Ø§ÙØ© ØªÙ†Ø³ÙŠÙ‚ Ø¥Ø¶Ø§ÙÙŠ Ù„Ù„Ø·Ø¨Ø§Ø¹Ø©
                    setTimeout(function() {
                        // ÙŠÙ…ÙƒÙ† Ø¥Ø¶Ø§ÙØ© Ø£ÙŠ ØªÙ‡ÙŠØ¦Ø© Ø¥Ø¶Ø§ÙÙŠØ© Ù‡Ù†Ø§
                    }, 100);
                };
            <\/script>
        </body>
        </html>
    `);
    
    printWindow.document.close();
}

// Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„Ù†Ø§ÙØ°Ø© Ø§Ù„Ù…Ù†Ø¨Ø«Ù‚Ø©
function closeModal() {
    document.getElementById('monthModal').style.display = 'none';
    document.body.style.overflow = 'auto';
}

// ØªÙ†Ø³ÙŠÙ‚ Ø§Ù„ØªØ§Ø±ÙŠØ®
function formatDate(dateString) {
    const date = new Date(dateString);
    const day = date.getDate().toString().padStart(2, '0');
    const month = (date.getMonth() + 1).toString().padStart(2, '0');
    const year = date.getFullYear();
    return `${day}/${month}/${year}`;
}

// Ø¯Ø§Ù„Ø© Ù„ØªÙ†Ø¸ÙŠÙ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù‚Ø¯ÙŠÙ…Ø© (Ø§Ø®ØªÙŠØ§Ø±ÙŠØ©)
function cleanupOldData() {
    const oneYearAgo = Date.now() - (365 * 24 * 60 * 60 * 1000);
    sales = sales.filter(sale => sale.timestamp > oneYearAgo);
    localStorage.setItem('sales', JSON.stringify(sales));
}

// ØªØ´ØºÙŠÙ„ Ø§Ù„ØªÙ†Ø¸ÙŠÙ ÙƒÙ„ 30 ÙŠÙˆÙ…
setInterval(cleanupOldData, 30 * 24 * 60 * 60 * 1000);



               
</script>
